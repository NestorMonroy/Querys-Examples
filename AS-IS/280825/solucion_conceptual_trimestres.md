# üéØ **Soluci√≥n Conceptual AS-IS: Sistema de Reportes por Trimestres**

## üß† **Entendimiento del Problema**

### **¬øQu√© me est√°n pidiendo exactamente?**
- **Reporte Principal**: Promedio de interacciones que tiene cada `numero_entrada` por d√≠a
- **Evoluci√≥n Temporal**: Expandir a semana, mes, a√±o
- **Estructura de Datos**: Por TRIMESTRES con fechas espec√≠ficas ya definidas
- **Problema de Datos**: `numero_entrada` ‚â† `numero_digitado` (¬øson v√°lidos? ¬øqu√© significan?)
- **Calidad**: Timestamps invertidos que necesitan correcci√≥n

### **Estructura Temporal Definida:**
```sql
-- Variables ya establecidas
SET @Q1_nombre = 'Q01_25';
SET @Q1_inicio = '2025-02-01'; 
SET @Q1_fin = '2025-03-31';    -- 59 d√≠as

SET @Q2_nombre = 'Q02_25';
SET @Q2_inicio = '2025-04-01';
SET @Q2_fin = '2025-06-30';    -- 91 d√≠as

SET @Q3_nombre = 'Q03_25';  
SET @Q3_inicio = '2025-07-01';
SET @Q3_fin = '2025-07-31';    -- 31 d√≠as (¬øper√≠odo incompleto?)
```

### **¬øQu√© representa conceptualmente cada elemento?**
- **`numero_entrada`** = Usuario/Cliente que inicia la interacci√≥n
- **`numero_digitado`** = ¬øDestino? ¬øN√∫mero procesado? ¬øEnrutamiento?
- **`id_8T`** = Grupo de zonas geogr√°ficas (dimensi√≥n territorial)
- **Un registro** = Una acci√≥n/decisi√≥n en el men√∫ del sistema
- **M√∫ltiples registros por d√≠a** = Journey completo del usuario
- **Trimestre** = Unidad de an√°lisis temporal y particionamiento de datos

---

## üìã **An√°lisis AS-IS: Contexto por Trimestres**

### **Datos Disponibles por Per√≠odo:**
```
Q01_25: llamadas_Q1 (Feb-Mar 2025) = 59 d√≠as h√°biles
Q02_25: llamadas_Q2 (Abr-Jun 2025) = 91 d√≠as h√°biles  
Q03_25: llamadas_Q3 (Jul 2025)     = 31 d√≠as h√°biles
```

### **Consideraciones Temporales AS-IS:**
- **Q1**: Per√≠odo completo (Feb-Mar) = Base de comparaci√≥n
- **Q2**: Per√≠odo completo (Abr-Jun) = Comparativo estacional  
- **Q3**: **¬øPer√≠odo parcial?** (Solo Julio) = Validar si est√° completo

### **Preguntas AS-IS Inmediatas:**
1. **¬øQ3 est√° completo o a√∫n capturando datos?**
2. **¬øLos rangos de fechas reflejan per√≠odos operativos reales?**
3. **¬øHay estacionalidad conocida entre trimestres?**
4. **¬øLos promedios deben calcularse por zona (`id_8T`) o globales?**

---

## üîç **Modelo Conceptual de An√°lisis**

### **Definici√≥n de Entidades**
```
USUARIO (numero_entrada) 
‚îú‚îÄ‚îÄ ZONA GEOGR√ÅFICA (id_8T)
‚îú‚îÄ‚îÄ TRIMESTRE (Q01_25, Q02_25, Q03_25)
    ‚îî‚îÄ‚îÄ SESI√ìN DIARIA (numero_entrada + fecha)
        ‚îú‚îÄ‚îÄ INTERACCI√ìN 1 (registro 1: men√∫ X, opci√≥n Y)
        ‚îú‚îÄ‚îÄ INTERACCI√ìN 2 (registro 2: men√∫ Z, opci√≥n W)
        ‚îî‚îÄ‚îÄ INTERACCI√ìN N (registro N: men√∫ A, opci√≥n B)
```

### **Clasificaci√≥n de Llamadas**
```
LLAMADAS OFICIALES: numero_entrada = numero_digitado
‚îú‚îÄ‚îÄ Comportamiento "normal" del usuario
‚îú‚îÄ‚îÄ Journey directo en el sistema
‚îî‚îÄ‚îÄ Base para c√°lculo de promedios

LLAMADAS DERIVADAS: numero_entrada ‚â† numero_digitado  
‚îú‚îÄ‚îÄ ¬øTransferencias internas?
‚îú‚îÄ‚îÄ ¬øEnrutamiento autom√°tico?
‚îú‚îÄ‚îÄ ¬øN√∫meros de prueba/testing?
‚îî‚îÄ‚îÄ INVESTIGAR: ¬øIncluir en promedios o no?
```

---

## üèóÔ∏è **Arquitectura de Soluci√≥n AS-IS**

### **Capa 1: Exploraci√≥n Inicial (SIN LIMPIAR A√öN)**

#### **A. An√°lisis de Contexto por Trimestre**
```sql
-- CONCEPTO: Entender el landscape ANTES de limpiar
SELECT 
    'Q1_2025' as trimestre,
    @Q1_inicio as fecha_inicio,
    @Q1_fin as fecha_fin,
    COUNT(*) as total_registros,
    COUNT(DISTINCT numero_entrada) as usuarios_unicos,
    COUNT(DISTINCT DATE(fecha)) as dias_con_datos,
    COUNT(DISTINCT id_8T) as zonas_activas,
    
    -- Problemas de calidad SIN corregir a√∫n
    SUM(CASE WHEN TIME_TO_SEC(hora_fin) - TIME_TO_SEC(hora_inicio) < 0 THEN 1 ELSE 0 END) as timestamps_invertidos,
    SUM(CASE WHEN numero_entrada != numero_digitado THEN 1 ELSE 0 END) as llamadas_derivadas,
    
    -- Porcentajes de problemas
    ROUND(SUM(CASE WHEN TIME_TO_SEC(hora_fin) - TIME_TO_SEC(hora_inicio) < 0 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as pct_timestamps_mal,
    ROUND(SUM(CASE WHEN numero_entrada != numero_digitado THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as pct_derivadas
    
FROM llamadas_Q1
WHERE fecha BETWEEN @Q1_inicio AND @Q1_fin

UNION ALL

SELECT 
    'Q2_2025' as trimestre,
    @Q2_inicio as fecha_inicio,
    @Q2_fin as fecha_fin,
    COUNT(*) as total_registros,
    COUNT(DISTINCT numero_entrada) as usuarios_unicos,
    COUNT(DISTINCT DATE(fecha)) as dias_con_datos,
    COUNT(DISTINCT id_8T) as zonas_activas,
    
    SUM(CASE WHEN TIME_TO_SEC(hora_fin) - TIME_TO_SEC(hora_inicio) < 0 THEN 1 ELSE 0 END) as timestamps_invertidos,
    SUM(CASE WHEN numero_entrada != numero_digitado THEN 1 ELSE 0 END) as llamadas_derivadas,
    
    ROUND(SUM(CASE WHEN TIME_TO_SEC(hora_fin) - TIME_TO_SEC(hora_inicio) < 0 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as pct_timestamps_mal,
    ROUND(SUM(CASE WHEN numero_entrada != numero_digitado THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as pct_derivadas
    
FROM llamadas_Q2
WHERE fecha BETWEEN @Q2_inicio AND @Q2_fin

UNION ALL

SELECT 
    'Q3_2025' as trimestre,
    @Q3_inicio as fecha_inicio,
    @Q3_fin as fecha_fin,
    COUNT(*) as total_registros,
    COUNT(DISTINCT numero_entrada) as usuarios_unicos,
    COUNT(DISTINCT DATE(fecha)) as dias_con_datos,
    COUNT(DISTINCT id_8T) as zonas_activas,
    
    SUM(CASE WHEN TIME_TO_SEC(hora_fin) - TIME_TO_SEC(hora_inicio) < 0 THEN 1 ELSE 0 END) as timestamps_invertidos,
    SUM(CASE WHEN numero_entrada != numero_digitado THEN 1 ELSE 0 END) as llamadas_derivadas,
    
    ROUND(SUM(CASE WHEN TIME_TO_SEC(hora_fin) - TIME_TO_SEC(hora_inicio) < 0 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as pct_timestamps_mal,
    ROUND(SUM(CASE WHEN numero_entrada != numero_digitado THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as pct_derivadas
    
FROM llamadas_Q3
WHERE fecha BETWEEN @Q3_inicio AND @Q3_fin;
```

#### **B. Investigaci√≥n Comportamiento DERIVADAS (Por Trimestre)**
```sql
-- CONCEPTO: ¬øQu√© sucede cuando numero_entrada ‚â† numero_digitado?
SELECT 
    'Q1_2025' as trimestre,
    numero_entrada,
    numero_digitado,
    id_8T as zona,
    COUNT(*) as frecuencia_uso,
    COUNT(DISTINCT DATE(fecha)) as dias_activos,
    AVG(TIME_TO_SEC(hora_fin) - TIME_TO_SEC(hora_inicio)) as duracion_promedio_seg,
    
    -- ¬øQu√© opciones usan?
    GROUP_CONCAT(DISTINCT CONCAT(menu, ':', opcion)) as opciones_usadas,
    
    -- ¬øPatr√≥n sospechoso?
    CASE 
        WHEN COUNT(DISTINCT DATE(fecha)) > 20 THEN 'POSIBLE_INTERNO'
        WHEN AVG(TIME_TO_SEC(hora_fin) - TIME_TO_SEC(hora_inicio)) < 5 THEN 'AUTOMATICO'
        WHEN COUNT(*) / COUNT(DISTINCT DATE(fecha)) > 15 THEN 'ALTO_VOLUMEN'
        ELSE 'NORMAL'
    END as patron_comportamiento
    
FROM llamadas_Q1
WHERE numero_entrada != numero_digitado
  AND fecha BETWEEN @Q1_inicio AND @Q1_fin
GROUP BY numero_entrada, numero_digitado, id_8T
ORDER BY frecuencia_uso DESC
LIMIT 20;

-- REPETIR PARA Q2 y Q3
```

#### **C. An√°lisis de Zonas Geogr√°ficas (Dimensi√≥n Clave)**
```sql
-- CONCEPTO: ¬øHay diferencias significativas por zona (id_8T)?
SELECT 
    id_8T as zona,
    COUNT(*) as total_interacciones,
    COUNT(DISTINCT numero_entrada) as usuarios_unicos,
    COUNT(DISTINCT DATE(fecha)) as dias_activos,
    
    -- Promedio BRUTO por zona (sin limpiar a√∫n)
    ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT numero_entrada) / COUNT(DISTINCT DATE(fecha)), 2) as promedio_bruto_diario,
    
    -- Distribuci√≥n oficial vs derivada
    SUM(CASE WHEN numero_entrada = numero_digitado THEN 1 ELSE 0 END) as oficiales,
    SUM(CASE WHEN numero_entrada != numero_digitado THEN 1 ELSE 0 END) as derivadas,
    ROUND(SUM(CASE WHEN numero_entrada = numero_digitado THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 1) as pct_oficiales
    
FROM (
    SELECT * FROM llamadas_Q1 WHERE fecha BETWEEN @Q1_inicio AND @Q1_fin
    UNION ALL
    SELECT * FROM llamadas_Q2 WHERE fecha BETWEEN @Q2_inicio AND @Q2_fin
    UNION ALL  
    SELECT * FROM llamadas_Q3 WHERE fecha BETWEEN @Q3_inicio AND @Q3_fin
) todas_llamadas
GROUP BY id_8T
ORDER BY total_interacciones DESC;
```

---

## üî¨ **Investigaci√≥n: numero_entrada ‚â† numero_digitado**

### **Hip√≥tesis a Validar (Enfoque AS-IS)**

#### **Hip√≥tesis 1: Enrutamiento Inteligente por Zona**
```sql
-- ¬øLas derivadas siguen patrones geogr√°ficos?
SELECT 
    id_8T as zona,
    'OFICIAL' as tipo,
    COUNT(DISTINCT numero_entrada) as usuarios_unicos,
    AVG(COUNT(*)) as promedio_interacciones_raw
FROM todas_llamadas 
WHERE numero_entrada = numero_digitado
GROUP BY id_8T

UNION ALL

SELECT 
    id_8T as zona,
    'DERIVADO' as tipo,
    COUNT(DISTINCT numero_entrada) as usuarios_unicos,
    AVG(COUNT(*)) as promedio_interacciones_raw
FROM todas_llamadas
WHERE numero_entrada != numero_digitado
GROUP BY id_8T
ORDER BY zona, tipo;
```

#### **Hip√≥tesis 2: Comportamiento Temporal**
```sql
-- ¬øLas derivadas var√≠an por trimestre?
SELECT 
    CASE 
        WHEN fecha BETWEEN @Q1_inicio AND @Q1_fin THEN 'Q1_2025'
        WHEN fecha BETWEEN @Q2_inicio AND @Q2_fin THEN 'Q2_2025' 
        WHEN fecha BETWEEN @Q3_inicio AND @Q3_fin THEN 'Q3_2025'
    END as trimestre,
    
    SUM(CASE WHEN numero_entrada = numero_digitado THEN 1 ELSE 0 END) as oficiales,
    SUM(CASE WHEN numero_entrada != numero_digitado THEN 1 ELSE 0 END) as derivadas,
    
    ROUND(SUM(CASE WHEN numero_entrada != numero_digitado THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as pct_derivadas
    
FROM todas_llamadas
GROUP BY trimestre
ORDER BY trimestre;
```

#### **Hip√≥tesis 3: Acceso a Men√∫s V√°lidos**
```sql
-- ¬øLas derivadas usan los mismos men√∫s/opciones que las oficiales?
SELECT 
    CASE WHEN numero_entrada = numero_digitado THEN 'OFICIAL' ELSE 'DERIVADO' END as tipo_llamada,
    menu,
    opcion,
    COUNT(*) as frecuencia,
    COUNT(DISTINCT numero_entrada) as usuarios_unicos,
    AVG(TIME_TO_SEC(hora_fin) - TIME_TO_SEC(hora_inicio)) as duracion_promedio
FROM todas_llamadas
WHERE menu IS NOT NULL AND opcion IS NOT NULL
GROUP BY tipo_llamada, menu, opcion
ORDER BY tipo_llamada, frecuencia DESC;
```

---

## üìä **Estrategia de Decisi√≥n AS-IS**

### **Matriz de Decisi√≥n: ¬øIncluir DERIVADOS en el promedio?**

| Escenario Descubierto | Criterio AS-IS | Decisi√≥n |
|----------------------|----------------|----------|
| **DERIVADOS < 10% total** | Poco impacto estad√≠stico | ‚úÖ Reportar solo OFICIALES |
| **DERIVADOS comportamiento similar** | Usuarios leg√≠timos | ‚úÖ Incluir ambos tipos |
| **DERIVADOS concentrados en 1-2 zonas** | Patr√≥n geogr√°fico espec√≠fico | üîÑ Reportar segmentado por zona |
| **DERIVADOS = n√∫meros con prefijo/patr√≥n** | Testing/internos identificables | ‚ùå Excluir del reporte |
| **DERIVADOS usan mismos men√∫s** | Funcionalidad v√°lida | ‚úÖ Reportar por separado |
| **DERIVADOS solo en Q3** | Cambio de sistema reciente | üîÑ Nota metodol√≥gica en reporte |

---

## üéØ **Plan de Ejecuci√≥n AS-IS**

### **Fase 1: Exploraci√≥n Inmediata (Esta Semana)**

#### **D√≠a 1-2: Reconnaissance Trimestral**
1. **Ejecutar Query A** ‚Üí Vol√∫menes y calidad por trimestre
2. **Validar Q3** ‚Üí ¬øEst√° completo o parcial?
3. **Identificar zonas dominantes** ‚Üí ¬øAlguna zona representa >50% del volumen?

#### **D√≠a 3-4: Investigaci√≥n DERIVADOS**
1. **Ejecutar Query B** ‚Üí Patrones de comportamiento DERIVADOS
2. **An√°lisis por zona** ‚Üí ¬øConcentraci√≥n geogr√°fica?
3. **An√°lisis temporal** ‚Üí ¬øVariaci√≥n por trimestre?

#### **D√≠a 5: Decision Point**
1. **Consolidar hallazgos** ‚Üí ¬øLimpiar masivamente o selectivamente?
2. **Definir estrategia DERIVADOS** ‚Üí ¬øIncluir, excluir, o segmentar?
3. **Validar con stakeholders** ‚Üí ¬øLas hip√≥tesis son correctas?

### **Fase 2: Implementaci√≥n (Pr√≥xima Semana)**
1. **Vista de limpieza** basada en hallazgos AS-IS
2. **Reporte prototipo** con decisiones validadas
3. **Testing con datos reales** de cada trimestre

### **Fase 3: Productivizaci√≥n (Tercera Semana)**
1. **Optimizaci√≥n MariaDB 10.1** con vol√∫menes reales
2. **Automatizaci√≥n** de reportes peri√≥dicos
3. **Documentaci√≥n** de decisiones metodol√≥gicas

---

## ‚ùì **Preguntas Cr√≠ticas AS-IS para Stakeholders**

### **Contexto Temporal**
1. **¬øQ3 est√° completo o continuar√° creciendo?**
2. **¬øLos trimestres reflejan per√≠odos operativos naturales?**
3. **¬øHay estacionalidad esperada entre Q1, Q2, Q3?**

### **Dimensi√≥n Geogr√°fica**
4. **¬øLos promedios deben calcularse por zona (`id_8T`) o globales?**
5. **¬øHay zonas con caracter√≠sticas operativas diferentes?**
6. **¬øAlguna zona debe excluirse del an√°lisis (testing, etc.)?**

### **Comportamiento DERIVADOS**
7. **¬øQu√© representa conceptualmente `numero_digitado` cuando difiere?**
8. **¬øEs posible que sean transferencias leg√≠timas del sistema?**
9. **¬øHay n√∫meros conocidos que siempre generan derivados?**

---

## üéØ **Entregables Esperados (Con Dimensi√≥n Trimestral)**

### **Reporte Principal AS-IS**
```
Trimestre | Fecha      | Zona | Usuarios Activos | Interacciones Totales | Promedio por Usuario
Q01_25    | 2025-02-15 | Z001 | 1,247           | 3,891                | 3.12
Q01_25    | 2025-02-15 | Z002 | 892             | 2,845                | 3.19
Q02_25    | 2025-04-15 | Z001 | 1,156           | 3,567                | 3.08
Q03_25    | 2025-07-15 | Z001 | 1,089           | 3,401                | 3.13
```

### **An√°lisis de Comportamiento DERIVADOS**
- **Distribuci√≥n por trimestre** y zona
- **Patrones de uso** (men√∫s/opciones frecuentes)  
- **Recomendaci√≥n** sobre inclusi√≥n en promedios

### **Insights Trimestrales**
- **Comparativo Q1 vs Q2 vs Q3** (considerando d√≠as disponibles)
- **Variaciones por zona geogr√°fica**
- **Evoluci√≥n temporal** con proyecciones

---

**üöÄ ¬øEmpezamos con el an√°lisis AS-IS trimestral para entender el contexto real antes de cualquier limpieza?**